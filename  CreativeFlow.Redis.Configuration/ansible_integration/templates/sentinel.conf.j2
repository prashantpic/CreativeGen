{#
  Jinja2 template for sentinel.conf
  Generated by Ansible for CreativeFlow.
  Based on SDS section 4.4.3.

  This template consumes a list of 'monitors' to configure which
  Redis masters this Sentinel instance should watch over.

  Required variables for each instance:
  - port
  - monitors (list of dictionaries)

  Each item in 'monitors' requires:
  - name
  - ip
  - port
  - auth_pass
#}
# CreativeFlow Redis Sentinel Configuration (Generated by Ansible)
# DO NOT EDIT THIS FILE MANUALLY. CHANGES WILL BE OVERWRITTEN.

# --- Sentinel Settings ---
port {{ port | default(sentinel_default_port) }}
daemonize yes
pidfile /var/run/redis-sentinel_{{ port | default(sentinel_default_port) }}.pid
logfile "{{ redis_log_dir }}/sentinel_{{ port | default(sentinel_default_port) }}.log"
dir "/tmp"

{% if announce_ip is defined %}
# For NAT/Docker environments where the Sentinel needs to announce a different IP
sentinel announce-ip {{ announce_ip }}
sentinel announce-port {{ port | default(sentinel_default_port) }}
{% endif %}

# --- Monitored Masters ---
{% for monitor in monitors %}
# Monitoring master: {{ monitor.name }}
sentinel monitor {{ monitor.name }} {{ monitor.ip }} {{ monitor.port }} {{ monitor.quorum | default(sentinel_default_quorum) }}
sentinel auth-pass {{ monitor.name }} "{{ monitor.auth_pass }}"
sentinel down-after-milliseconds {{ monitor.name }} {{ monitor.down_after_milliseconds | default(sentinel_default_down_after_ms) }}
sentinel parallel-syncs {{ monitor.name }} 1
sentinel failover-timeout {{ monitor.name }} {{ monitor.failover_timeout | default(sentinel_default_failover_timeout_ms) }}

{% endfor %}